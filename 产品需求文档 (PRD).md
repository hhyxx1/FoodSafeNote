# 鲜度与健康卫士 (Fresh & Fit) v6.0.0 产品需求文档（修改后）

## 基础信息

表格

| 项目名称 | 食安记(Food Safe Note)                                       |
| -------- | ------------------------------------------------------------ |
| 版本号   | v6.0.0 (HarmonyOS 6.0 / API 20 )                             |
| 状态     | 最终定稿 (Final)                                             |
| 适用平台 | HarmonyOS Next（手机、平板 <全功能>；手表、智慧屏 < 轻量化 >） |
| 核心理念 | “智能优先 (Intelligence First)” —— 从被动的库存工具进化为主动的家庭健康智能应用，移除应用内后台服务依赖，通过本地交互实现核心能力，保障数据准确性与用户绝对控制权；条码商品信息实现「两层本地匹配 + 强制用户校验 + 可编辑修改 + 沉淀记忆」的全闭环，所有匹配结果均需用户确认，错误可即时修正。 |
| 核心原则 | 全程本地获取 + 匹配后强制校验，不依赖任何联网条码接口 / 第三方商品库，贴合「零服务端、离线可用、数据不上云、易过审」核心设计，所有条码关联信息均由用户最终确认，系统不做无依据的自动填充 / 覆盖。 |

## 1. 项目背景与目标

### 1.1 项目背景

传统食品管理应用存在 “录入繁琐”、“数据孤岛” 和 “被动服务” 三大痛点；条码商品信息多依赖联网接口，存在隐私泄露、离线不可用、信息错误无修正渠道的问题。移除应用内后台服务方案，简化交互入口；已完善**OCR 热量校验闭环**、**条码商品信息本地两层获取闭环**，本次新增**条码匹配信息强制校验修改逻辑**，明确核心入库方式为手动添加，解决条码对应商品信息错误及热量数据来源不明确的核心问题，实现用户对所有数据的绝对控制权。

### 1.2 项目目标

开发一款基于 ArkTS (API 20+) 的原生智能应用（移除应用内后台服务），达成四大核心目标：

1. **原生智能 (Native Intelligence)**：核心入库方式为手动添加（扫码、拍照），剪贴板解析仅为辅助；OCR 识别结果支持用户校验并沉淀至本地记忆；条码商品信息实现「两层本地匹配 + 强制用户校验 + 即时修改」，无论匹配结果是否存在，最终商品信息均由用户确认，错误可即时修正，修正后自动沉淀至本地记忆库。
2. **全员平权 (All-Master)**：摒弃账号体系，采用 “设备即身份” 的家庭协作模式，无管理员，家庭成员平等操作。
3. **三重数据闭环**：建立「库存 - 消耗 - 健康」的业务流转闭环、「OCR 识别 - 用户校验 - 本地记忆」的热量数据闭环（移除预置匹配层）、「条码扫码 - 本地匹配 - 用户校验修改 - 确认沉淀 - 记忆复用」的条码商品信息全闭环。
4. **隐私安全 + 数据准确**：零服务端成本，数据纯本地存储 / 流转；所有 AI 匹配、本地库匹配的信息均需用户最终确认，系统不编造、不强制使用任何未经验证的信息，从源头保证数据准确性。

## 2. 核心概念 (Core Concepts)

### 2.1 全平台适配规则

- 手机端 + 平板端：功能完全一致，仅做 UI 适配，支持食品管理、健康管理全功能；
- 手表端 + 智慧屏：仅支持轻量化功能，包括「查看食物状态（正常 / 临期 / 过期）」「查看家庭成员热量摄入数据」，无入库、消耗、编辑等操作能力。

### 2.2 全员平权 (All-Master Model)

无管理员，家庭成员地位平等，任何拿到设备的人均可录入、消耗食品信息；“爸爸 / 妈妈” 等家庭标签仅作为热量账单的归属标识，非登录账号，不关联实名认证。

### 2.3 热量数据闭环 (Calorie Data Closed Loop)

OCR 识别提取热量值后，弹窗展示结果供用户手动修改校验，确认后的最终值自动存入本地记忆库（ProductDict），后续同类食品优先复用该数据；无有效识别结果时不编造数据，仅引导用户手动录入，实现 “识别 - 校验 - 沉淀 - 复用” 的完整闭环（移除预置匹配层，仅保留本地记忆 + OCR / 手动录入）。

### 2.4 条码商品信息全闭环 (Barcode Info Full Closed Loop)

条码商品信息采用「两层本地匹配 + 强制校验 + 即时修改 + 沉淀记忆」模式：扫码后先匹配本地记忆库 / 内置条码库，无论匹配是否成功，均弹窗展示信息让用户检查 / 录入 / 修改，用户确认后的最终信息自动沉淀至本地记忆库，后续扫码同一条码直接复用修正后的信息，实现 “一次修正，永久复用”；条码匹配的信息仅为 “参考建议”，最终生效的商品信息由用户决定，彻底解决匹配信息错误问题。

## 3. 功能需求详解 (Functional Requirements)

### 3.1 模块一：智能入库 (Intelligent Entry)

表格

| ID   | 功能名称       | 详细描述                                                     | 优先级 | 涉及新 Kit (API 20+)       |
| ---- | -------------- | ------------------------------------------------------------ | ------ | -------------------------- |
| F1.1 | 剪贴板辅助入库 | 仅作为辅助入库方式：用户手动触发应用内 “剪贴板解析” 功能，分析购物清单文本生成 “待入库卡片”，解析置信度 < 0.8 时弹窗询问用户是否生成，避免误解析；核心入库方式为手动添加（扫码 / 拍照）。 | P2     | 应用内文本解析逻辑         |
| F1.2 | 拍照手动添加   | 核心入库方式之一：拍摄非标品（如青菜、水果）后，调用 API 20 增强版 Core Vision Kit 能力，自动抠除背景并识别物体属性（如识别为 “生菜”“苹果”），自动关联本地记忆库热量数据并生成悬浮贴纸；若设备无 NPU 支持，自动降级为 “普通拍照 + 矩形裁剪” 模式；拍照添加完成后自动进入热量记录流程。 | P0     | Core Vision Kit (Enhanced) |
| F1.3 | 扫码手动添加   | 核心入库方式之一：升级版 Scan Kit，支持在视频流中连续、批量识别多个条码，利用 API 20 的并发能力实现离线实时入库，无需停顿；核心条码流程：扫码识别条码→本地依次匹配「产品字典库 (记忆)」→「内置条码库」→✅匹配成功：弹窗展示匹配参考信息（商品名 / 品类 / 规格），支持用户手动编辑修改，用户检查确认后进入热量记录流程；❌匹配失败：弹窗引导用户手动录入商品信息（商品名必填），录入完成后进入热量记录流程；最终规则：无论匹配是否成功，仅以用户确认 / 修改后的最终信息为准，确认后自动将「条码 + 最终信息」存入本地记忆库，后续扫码直接复用。 | P0     | Scan Kit、TaskPool         |
| F1.4 | 热量两层获取   | 1. 本地记忆：查 ProductDict（用户教过 / OCR 存入 / 条码修正后的数据），有条码则以条码为唯一键查询，无条码则以「品类 + 名称」为键；2. OCR 识别 / 手动录入：无本地记忆数据时，点击 “拍营养表” 调用 TextRecognition 自动提取 Energy 数值，识别后弹窗展示结果支持用户手动修改，无有效识别结果时引导用户手动录入；全程遵循 “系统不编造数据” 原则，无有效热量数据时默认填入 0，并高亮提示用户手动补录；热量获取完成后完成入库全流程。 | P0     | TextRecognition            |
| F1.5 | 环境感知保质期 | 区分食品类型适配逻辑：1. 包装食品：直接使用商品标注的固定保质期（如OCR未识别到手动填写），无环境感知计算逻辑；2. 生鲜果蔬 / 散称食物：根据用户确认后的商品品类 + 存储环境（冷藏 / 冷冻 / 常温），通过内置算法自动计算并预填过期日期，支持用户手动修正预填结果，手动修改后以用户输入的日期为准。 | P0     | 逻辑运算                   |

### 3.2 模块二：沉浸式库存与实况 (Immersive Inventory)

表格

| ID   | 功能名称     | 详细描述                                                     | 优先级 | 涉及新 Kit (API 20+)           |
| ---- | ------------ | ------------------------------------------------------------ | ------ | ------------------------------ |
| F2.1 | 实况窗预警   | 当有食品剩余保质期 < 24 小时时，在状态栏胶囊和锁屏界面显示动态倒计时（仅手机 / 平板端），倒计时文字采用渐变色渲染（随保质期临近加深），提醒用户及时食用；低电量 / 省电模式下暂停预警；手表 / 智慧屏仅查看该状态，无预警能力。 | P0     | Live View Kit、Lock Screen Kit |
| F2.2 | 分布式实物墙 | 手机、平板端库存数据通过鸿蒙软总线实现毫秒级同步，UI 采用 ArkUI V2 (`@ObservedV2`) 渲染高性能瀑布流，展示 AI 抠图后的食品实物贴纸，支持下拉刷新、上滑加载；手表 / 智慧屏仅展示实物墙轻量化视图（仅查看，无操作）；500 + 库存项时仍保持流畅交互。 | P0     | Distributed RDB、ArkUI V2      |

### 3.3 模块三：无界消耗闭环 (Boundless Consumption)

表格

| ID   | 功能名称       | 详细描述                                                     | 优先级 | 涉及新 Kit (API 20+)                      |
| ---- | -------------- | ------------------------------------------------------------ | ------ | ----------------------------------------- |
| F3.1 | 跨设备拖拽 2.0 | 仅支持手机↔平板跨设备交互：手机端显示食品库存，平板端显示家庭健康看板，用户直接从手机屏幕长按某一食品，跨屏拖拽至平板的家庭成员头像上，完成食品消耗操作；利用 API 20 的延迟数据交付能力，实现丝滑的跨设备交互体验；手表 / 智慧屏无拖拽操作能力。 | P0     | Drag Framework (API 20)、Unified Data Kit |
| F3.2 | 处理动作       | 仅手机 / 平板端支持：点击库存中任意食品，弹出操作面板，包含两大核心动作：1. “吃掉”：选择家庭成员头像，将食品热量分摊至对应成员，计入个人健康热量流；2. “扔掉”：将食品标记为浪费，计入家庭食品浪费流，支持备注浪费原因（选填）；手表 / 智慧屏无处理动作能力。 | P0     | CustomDialog                              |
| F3.3 | 健康报表       | 基于 F3.2 的食品消耗归属记录，自动生成每位家庭成员的每日 / 每周热量摄入曲线，同时生成家庭食品浪费分析图表（含浪费率、浪费品类分布）；报表仅支持本地截图，截图后调用系统图片分享能力（支持微信、QQ 等），无 JSON 导出、无联网分享功能。 | P1     | ArkUI Charts                              |

### 3.4 模块四：本地记忆管理

表格

| ID   | 功能名称       | 详细描述                                                     | 优先级 | 涉及新 Kit (API 20+) |
| ---- | -------------- | ------------------------------------------------------------ | ------ | -------------------- |
| F4.1 | 产品字典管理   | 提供 “产品字典” 专属入口（仅手机 / 平板端），展示所有存入 ProductDict 的商品数据，包括条码 / 品类 + 名称、商品名、品类、规格、热量值、数据来源；支持用户手动编辑 / 删除任意字段，条码商品支持单独解绑 / 重新关联条码；手表 / 智慧屏仅查看字典数据，无编辑能力。 | P1     | ArkUI V2 列表渲染    |
| F4.2 | OCR 记录查询   | 记录近 30 天的 OCR 识别 + 校验记录（仅手机 / 平板端可查），展示每条记录的识别时间、食品名称、条码、AI 识别值、用户最终确认值；支持用户根据时间 / 食品名称检索，回溯并修改历史记录；手表 / 智慧屏无查询能力。 | P2     | 本地数据库查询       |
| F4.3 | 内置条码库更新 | 移除该功能，内置条码库仅使用应用安装包自带数据，无任何更新入口。 | --     | --                   |

## 4. 业务规则与逻辑边界 (Business Rules & Logic)

### 4.1 智能触发规则

表格

| 规则         | 定义                                                         | 异常兜底                                                |
| ------------ | ------------------------------------------------------------ | ------------------------------------------------------- |
| 文本解析规则 | 仅当剪贴板文本包含 “购买完成 / 已买 / 入库 / 采购” 等关键词，且包含具体食材名称时，才触发入库卡片生成逻辑；该功能仅为辅助，核心入库依赖手动扫码 / 拍照。 | 解析置信度 < 0.8 时，弹窗询问用户，不自动生成入库卡片。 |
| 功耗控制规则 | 无应用内后台服务，仅在前台操作时触发库存校验、保质期计算等逻辑，无后台任务运行。 | 无后台任务，无需低电量 / 省电模式兜底逻辑。             |

### 4.2 分布式一致性规则

表格

| 规则           | 定义                                                         | 异常兜底                                                     |
| -------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 冲突解决 (LWW) | 分布式数据同步采用 Last Write Wins 原则，基于毫秒级时间戳，最后修改的设备数据覆盖旧数据（仅手机 / 平板 / 智慧屏同步；手表仅拉取数据，无修改能力）。 | 时间戳冲突时，保留设备 ID 排序靠前的设备数据。               |
| 原子性拖拽     | 跨设备消耗的拖拽操作视为原子操作，执行流程：平板锁定→手机端扣减库存→平板接收数据→解锁（仅手机↔平板）。 | 传输中断时，手机端自动回滚库存（库存数量 + 1），避免数据不一致。 |

### 4.3 数据获取降级规则

表格

| 规则                           | 定义                                                         |
| ------------------------------ | ------------------------------------------------------------ |
| 热量缺失规则                   | 若无本地记忆数据且 OCR 识别失败，默认填入 0，并高亮提示用户手动补录；系统不编造任何无依据的热量值（移除预置匹配层）。 |
| 无 NPU 设备规则                | 若设备不支持 Core Vision Kit，拍照添加功能自动降级为 “普通拍照 + 矩形裁剪”，用户手动框选食品主体。 |
| OCR 识别校验规则               | 1. OCR 识别结果为非数字 / 负数时，弹窗默认填充 0，提示 “AI 未识别到有效热量值，请手动输入”；2. 用户取消校验弹窗时，放弃本次 OCR 结果，不写入本地记忆库；3. 校验后的最终值需 > 0 才存入 ProductDict，0 值不存储。 |
| 本地记忆存储规则               | 1. 有条码的食品：以条码为唯一标识存入 ProductDict，用户修改确认后的条码信息会直接覆盖原有匹配数据；2. 无条码的非标品：以「品类 + 名称」为唯一标识，重复时覆盖原有数据；3. 存入的数据永久保留，用户可在 “产品字典管理” 中手动删除 / 编辑。 |
| 条码商品信息两层获取规则       | 第一层（最高优先级）：本地记忆库 (ProductDict) - 以扫码得到的条码为键，查询 ProductDict，匹配成功则返回商品名、品类、规格、热量等全部信息；第二层：内置本地条码库 - 本地记忆库无匹配时，查询应用内置的条码 JSON 库，匹配成功则返回基础商品参考信息（商品名、品类）；无匹配则引导用户手动录入；前两层匹配结果均为参考信息，必须经用户检查 / 修改 / 确认后才生效。 |
| 内置条码库规则                 | 1. 内置条码库为离线 JSON 包，打包在应用安装包内，体积控制在 10MB 以内，精选 5000 + 高频生鲜 / 零食 / 饮料 / 日用品条码；2. 内置条码库仅包含条码、商品名、基础品类，不包含热量（热量需单独通过本地记忆 / OCR / 手动录入获取）；3. 无任何更新能力，仅使用应用自带数据。 |
| 条码匹配后强制校验修改核心规则 | 1. 强制校验：无论本地记忆库 / 内置条码库是否匹配成功，扫码后均需弹窗展示匹配的参考信息（无匹配则展示空白录入框），必须经用户检查确认后才能进入后续流程，禁止系统自动使用未经验证的信息；2. 即时修改：弹窗内支持用户对商品名、品类、规格等信息自由编辑修改，所有字段均为可编辑状态，参考信息为默认填充值；3. 确认生效：仅以用户点击 “确认” 后的最终信息为准，确认后自动将「条码 + 最终信息」存入本地记忆库，后续扫码同一条码直接复用该修正后的信息；4. 取消终止：用户点击 “取消” 则直接终止本次扫码入库流程，无任何数据存储 / 操作。 |
| 条码手动录入规则               | 1. 手动录入 / 修改时商品名为必填项，条码为系统自动带入（不可修改），其余字段（品类、规格）为选填；2. 录入 / 修改后的最终数据自动同步至分布式数据库，同一华为账号的所有设备均可复用；3. 支持用户后续在 “产品字典管理” 中对已沉淀的条码信息进行二次编辑 / 补充。 |
| 保质期计算规则                 | 1. 包装食品：直接使用用户录入 / 确认的固定保质期，无环境加权计算；2. 生鲜果蔬 / 散称食物：基础保质期天数取自本地知识库，环境加权规则为「冷冻延长 10 倍，常温减半，冷藏为基础值」，开封后保质期除以 3；支持用户手动修正计算结果。 |

## 5. 核心算法逻辑 (Core Algorithms)

### 5.1 条码商品信息匹配 + 强制校验修改算法

typescript

```
/**
 * 条码商品信息两层本地匹配（移除无实际意义的注释，简化逻辑）
 * @param barcode 扫码识别的商品条码
 * @returns 匹配后的商品参考信息（无匹配则返回null）
 */
async function matchBarcodeInfo(barcode: string): Promise<{name: string, category: string, spec?: string} | null> {
  // 第一层：匹配本地记忆库（ProductDict）- 优先级最高
  const memoryInfo = await LocalDB.queryProductDictByBarcode(barcode);
  if (memoryInfo && memoryInfo.name) {
    return {
      name: memoryInfo.name,
      category: memoryInfo.category || "",
      spec: memoryInfo.spec || ""
    };
  }

  // 第二层：匹配内置本地条码库
  const builtInInfo = BuiltInBarcodeLibrary.find(item => item.barcode === barcode);
  if (builtInInfo) {
    return {
      name: builtInInfo.name,
      category: builtInInfo.category || "",
      spec: "" // 内置库仅提供基础信息，规格由用户补充/修改
    };
  }

  // 无匹配，返回null（后续引导用户手动录入/修改）
  return null;
}

/**
 * 条码匹配后校验修改弹窗（逻辑不变，仅作为手动添加的环节）
 * @param barcode 系统自动带入的条码（不可修改）
 * @param refInfo 匹配到的参考信息（无匹配则为null）
 * @returns 用户确认后的最终商品信息（取消则返回null）
 */
async function showBarcodeCheckEditDialog(barcode: string, refInfo: {name: string, category: string, spec?: string} | null): Promise<{name: string, category?: string, spec?: string} | null> {
  return new Promise((resolve) => {
    const defaultName = refInfo?.name || "";
    const defaultCate = refInfo?.category || "";
    const defaultSpec = refInfo?.spec || "";

    const dialog = new CustomDialog({
      title: refInfo ? "条码信息校验（可修改）" : "条码无匹配，录入商品信息",
      content: `条码：${barcode}（不可修改）`,
      inputs: [
        {
          type: "text",
          label: "商品名*",
          placeholder: "如：纯牛奶、原味薯片",
          required: true,
          defaultValue: defaultName
        },
        {
          type: "text",
          label: "商品品类",
          placeholder: "如：乳制品、零食（选填）",
          defaultValue: defaultCate
        },
        {
          type: "text",
          label: "商品规格",
          placeholder: "如：250ml、100g（选填）",
          defaultValue: defaultSpec
        }
      ],
      buttons: [
        { text: "取消", action: () => resolve(null) },
        { text: "确认", action: (inputs) => {
          if (!inputs[0].value) return resolve(null);
          resolve({
            name: inputs[0].value,
            category: inputs[1].value || "",
            spec: inputs[2].value || ""
          });
        }}
      ]
    });
    dialog.show();
  });
}

/**
 * 扫码手动添加全流程：条码匹配 → 强制校验修改 → 信息补全 → 热量获取 → 入库
 * @param barcode 扫码识别的条码
 * @param storageType 存储环境（冷藏/冷冻/常温）
 */
async function barcodeScanEntry(barcode: string, storageType: string) {
  // 1. 条码商品信息两层匹配（获取参考信息）
  const barcodeRefInfo = await matchBarcodeInfo(barcode);

  // 2. 强制校验修改，仅以用户最终值为准
  const finalProductInfo = await showBarcodeCheckEditDialog(barcode, barcodeRefInfo);
  if (!finalProductInfo || !finalProductInfo.name) {
    return;
  }
  const { name: productName, category: productCategory, spec: productSpec } = finalProductInfo;

  // 3. 存入本地记忆库
  await LocalDB.insertProductDict({
    key: barcode,
    barcode: barcode,
    name: productName,
    category: productCategory,
    spec: productSpec,
    calories: 0, // 热量后续通过两层获取逻辑填充
    update_time: Date.now(),
    source: barcodeRefInfo ? "edited" : "manual"
  });

  // 4. 联动获取热量值（两层获取，移除预置匹配）
  const calorie = await fetchCalories(barcode, productCategory, productName);

  // 5. 保质期计算（区分包装/生鲜）
  const isPackaged = await checkIsPackagedFood(productCategory); // 新增包装食品判断逻辑
  let expiryDate = 0;
  if (isPackaged) {
    expiryDate = await getPackagedFoodExpiry(); // 手动录入包装食品保质期
  } else {
    expiryDate = calculateExpiry(productCategory, storageType); // 生鲜走环境感知逻辑
  }

  // 6. 生成入库卡片，用户二次确认后完成入库
  const isConfirm = await showEntryCardDialog({
    name: productName,
    category: productCategory,
    spec: productSpec,
    barcode: barcode,
    calories: calorie,
    expiryDate: expiryDate,
    storageType: storageType
  });

  if (isConfirm) {
    await LocalDB.insertFoodItem({
      storage_type: storageType,
      expiry_date: expiryDate,
      image_sticker: "",
      calories: calorie,
      status: 0,
      barcode: barcode,
      name: productName,
      category: productCategory
    });
    await DistributedDB.syncFoodItem();
  }
}

// 新增包装食品判断辅助函数
async function checkIsPackagedFood(category: string): Promise<boolean> {
  const packagedCateList = ["乳制品", "零食", "饮料", "调味品"]; // 示例分类，可扩展
  return packagedCateList.includes(category);
}

// 包装食品保质期手动录入函数
async function getPackagedFoodExpiry(): Promise<number> {
  // 弹窗引导用户录入包装食品保质期，返回时间戳
}
```

### 5.2 热量两层获取策略 

typescript

```
/**
 * 热量两层获取+OCR校验+本地存储闭环（移除预置匹配，仅保留本地记忆+OCR/手动）
 * @param barcode 食品条码（无则传空）
 * @param category 食品品类
 * @param name 食品名称
 * @returns 最终确认的热量值（kcal/100g）
 */
async function fetchCalories(barcode: string, category: string, name: string): Promise<number> {
  // 策略1: 优先查本地记忆库（有条码则以条码为键，无则用品类+名称）
  const memoryKey = barcode || `${category}_${name}`;
  const memory = await LocalDB.queryProductDict(memoryKey);
  if (memory && memory.calories > 0) return memory.calories;

  // 策略2: OCR识别 + 用户校验 + 本地存储（无预置匹配）
  const ocrCalorie = await triggerNutritionOCR();
  let finalCalorie = 0;
  if (ocrCalorie > 0) {
    finalCalorie = await showCalorieCheckDialog(ocrCalorie); 
  } else {
    finalCalorie = await showCalorieInputDialog();
  }

  // 仅当最终值>0时，存入本地记忆库
  if (finalCalorie > 0) {
    await LocalDB.insertProductDict({
      key: memoryKey,
      barcode: barcode || "",
      name: name,
      category: category,
      calories: finalCalorie,
      update_time: Date.now(),
      source: ocrCalorie > 0 ? "ocr" : "manual"
    });
    await DistributedDB.syncProductDict(memoryKey, finalCalorie);
  }

  return finalCalorie;
}

// 弹窗函数逻辑不变
async function showCalorieCheckDialog(ocrValue: number): Promise<number> {}
async function showCalorieInputDialog(): Promise<number> {}
async function triggerNutritionOCR(): Promise<number> {}
```

### 5.3 智能保质期算法 (区分包装 / 生鲜)

typescript

```
function calculateExpiry(category, storageType, isOpened = false) {
  // 仅生鲜/散称食品走该逻辑，包装食品已提前过滤
  let baseDays = LocalKnowledgeBase.getDays(category); 
  let factor = (storageType == 'FREEZER') ? 10 : (storageType == 'ROOM') ? 0.5 : 1;
  if (isOpened) factor = factor / 3;
  return Today + (baseDays * factor);
}
```

## 6. 数据库设计 (Database Schema)

数据库结构无核心变更，仅因「热量预置匹配层移除」，无需新增预置库相关表；因「内置条码库无更新」，移除条码库更新相关字段 / 逻辑。

## 7. 技术架构 (Technical Architecture)

### 7.1 技术栈

- 开发语言: ArkTS (HarmonyOS 6.0.0 / API 20)
- UI 框架: ArkUI V2（手机 / 平板全功能 UI 适配；手表 / 智慧屏轻量化 UI）
- 数据层: Distributed Data Kit (分布式数据同步) + Unified Data Kit (UDMF 拖拽协议) + RelationalStore (SQLite 本地数据库) + 本地 JSON 文件（内置条码库）
- AI 能力: Core Vision Kit (增强版抠图 / OCR)、TextRecognition (营养表文字识别)
- 条码能力: Scan Kit (流式多码识别) + TaskPool (并发处理)
- 交互组件: CustomDialog (各类校验 / 录入 / 操作弹窗)
- 系统能力: Live View Kit、Lock Screen Kit、Drag Framework (API 20)、鸿蒙软总线、系统图片分享能力

### 7.2 整体架构层

plaintext

```
┌─────────────────────────────────────────┐
│ 应用层 (App Layer)                      │
│  ├─ 手机/平板：全功能（入库/库存/消耗/报表）│
│  ├─ 手表/智慧屏：轻量化查看功能         │
│  └─ 剪贴板辅助入库（非核心）            │
├─────────────────────────────────────────┤
│ 条码匹配层 (Barcode Match Layer)        │
│  ├─ 本地记忆库匹配 (ProductDict)        │
│  ├─ 内置本地条码库匹配 (JSON)           │
│  └─ 校验修改子层（用户确认/编辑）       │
├─────────────────────────────────────────┤
│ 合规校验层 (Compliance Layer)           │
│  ├─ 分布式同步开关/权限校验            │
│  ├─ 隐私政策状态校验                   │
│  └─ 无后台服务，仅前台功耗控制          │
├─────────────────────────────────────────┤
│ 系统层 (System Layer)                   │
│  ├─ Scan Kit/TextRecognition/Core Vision│
│  ├─ Distributed Data Kit (加密同步)     │
│  ├─ 鸿蒙软总线 (点对点设备通信)         │
│  ├─ 系统图片分享能力（无联网）          │
│  └─ 本地 NPU (AI 推理/本地计算)         │
└─────────────────────────────────────────┘
```

### 7.3 数据流向图

1. **条码手动添加流程**: 扫码识别条码 → 条码匹配层（记忆库→内置库）→ 强制校验修改 → 存入本地记忆库 → 热量两层获取 → 保质期计算（区分包装 / 生鲜）→ 写入本地 DB → 分布式同步 → 实况窗注册（仅手机 / 平板）。
2. **拍照手动添加流程**: 拍照 / 抠图 → 识别食品属性 → 热量两层获取 → 保质期计算（仅生鲜）→ 写入本地 DB → 分布式同步 → 实况窗注册（仅手机 / 平板）。
3. **食品消耗流程**: 跨屏拖拽 / 手动操作（仅手机 / 平板）→ 消耗扣减 → 热量计入健康流 / 浪费流 → 写入本地 DB → 分布式同步 → 健康报表更新（手表 / 智慧屏仅查看）。

## 8. 全生命周期管理 (Lifecycle Management)

### 8.1 食品库存生命周期

1. **正常 (Normal)**: 食品保质期 > 3 天，库存正常展示，无预警。
2. **临期 (Near Expiry)**: 食品保质期 ≤ 3 天，应用内后台服务触发实况窗预警（状态栏 / 锁屏），库存列表标红展示。
3. **过期 (Expired)**: 当前时间 > 过期时间戳，每日凌晨 03:00 由应用内定时任务自动标记，库存 UI 置灰并沉底展示，禁止 “吃掉” 操作，仅支持 “扔掉”。
4. **消耗 (Consumed)**: 用户点击 “吃掉” 并选择家庭成员，食品状态标记为消耗，热量计入对应成员健康流，库存中隐藏该食品。
5. **浪费 (Wasted)**: 用户点击 “扔掉”，食品状态标记为浪费，计入家庭浪费流，库存中隐藏该食品，支持备注浪费原因。

### 8.2 条码商品信息生命周期

扫码匹配 → 校验修改（用户确认 / 编辑）→ 确认沉淀至本地记忆库 → 分布式同步至同一华为账号所有设备 → 永久保留（用户可控）→ 后续扫码直接复用 → 支持在产品字典中二次编辑 / 删除 → 删除后恢复至 “未匹配” 状态，下次扫码重新进入匹配 / 录入流程。

### 8.3 热量数据生命周期

OCR 识别 / 手动录入 → 用户校验修改 → 确认沉淀至本地记忆库 → 分布式同步 → 食品入库时关联至对应食品 → 食品消耗时计入健康流 / 浪费流 → 永久保留在 OCR 记录 / 健康报表中，支持回溯修改。

### 8.4 补充

- 手表 / 智慧屏仅可查看食品全生命周期状态（正常 / 临期 / 过期 / 消耗 / 浪费），无操作权限；
- 条码 / 热量数据生命周期中，移除 “应用内后台服务触发” 相关逻辑，仅由前台操作触发数据沉淀 / 同步。

## 9. 非功能性需求 (Non-Functional)

1. **隐私第一**：所有 AI 推理（OCR / 抠图）、条码匹配、数据计算均在设备本地完成，无任何数据（含条码、食品信息、热量数据、家庭记录）上传至云端 / 第三方服务器；跨设备同步通过鸿蒙软总线点对点加密传输，仅在同一华为账号设备间流转；系统图片分享仅调用本地能力，无联网行为。
2. **数据安全**：提供 JSON 全量导出 / 导入功能，支持「食品库存 + 产品字典 + OCR 记录 + 家庭成员档案」一键导出，作为冷备份手段；产品字典支持单独导出 / 导入，防止误删应用导致数据丢失；所有本地数据库均做加密处理。
3. **高性能**：利用 API 20 的 TaskPool 实现并发处理，ArkUI V2 实现高性能渲染；确保在 500 + 库存项、1000 + 本地条码记忆时，扫码匹配响应时间 < 500ms，库存列表滑动帧率稳定 120Hz，无卡顿。
4. **离线可用**：全程无需联网，所有核心功能（条码匹配、扫码入库、热量获取、库存管理、跨设备同步、健康报表）100% 离线可用；仅本地文件导入 / 导出需访问设备本地存储。
5. **数据准确性**：所有 AI 生成的热量值、条码匹配的商品信息均需用户校验 / 编辑确认；无匹配 / 识别结果时不编造数据，仅引导用户手动录入；条码匹配信息经用户最终确认，错误可即时修正，从源头保证数据准确。
6. **可追溯性**：OCR 识别记录、条码手动录入 / 编辑记录各保留 30 天，支持用户根据时间 / 食品名称检索回溯；健康报表 / 浪费记录永久保留，支持本地导出查看。
7. **安装包体积**：应用安装包整体体积控制在 50MB 以内，其中内置条码库 + 预置生鲜库整体体积≤20MB，避免安装包过大影响用户下载体验。
8. **设备兼容性**：手机 / 平板功能完全对齐，UI 适配不同屏幕尺寸；手表 / 智慧屏仅保留查看能力，交互逻辑极简，适配小屏 / 大屏交互习惯。无 NPU 设备、低配置设备均有对应的功能降级方案，确保核心功能可用。
9. **易用性**：操作流程极简，减少用户手动输入步骤，AI 自动填充参考信息；家庭成员无操作门槛，无需注册 / 登录，拿到设备即可使用。

## 10. 页面设计需求 (Page Design Requirements)

### 10.1 页面设计核心原则

表格

|    设计原则    |                           详细要求                           |
| :------------: | :----------------------------------------------------------: |
|   一致性原则   | 全平台（手机 / 平板 / 手表 / 智慧屏）采用统一的视觉语言（色彩、字体、图标体系），仅根据设备特性调整布局与交互方式；核心操作按钮（确认 / 取消 / 入库）样式、位置、交互反馈全平台统一。 |
|  极简交互原则  | 减少冗余页面跳转，核心流程（扫码 / 拍照入库→校验→确认）≤3 步完成；所有弹窗仅展示必要信息，非必填项默认隐藏 / 后置。 |
|  适配优先原则  | 手机 / 平板端采用 “响应式布局”，适配 1080P~4K 分辨率、4:3~19.5:9 屏幕比例；手表端仅保留核心信息展示，智慧屏端适配大屏远距离操作逻辑（按钮尺寸≥60dp）。 |
|  容错友好原则  | 操作错误 / 数据缺失时，页面即时给出引导性提示（而非纯错误提示），例如 “商品名不能为空，填写后可完成入库”；支持操作回退（如入库前取消、修改后返回）。 |
| 隐私可视化原则 | 本地数据相关页面（如产品字典）增加 “数据仅本地存储” 标识，强化用户隐私感知；无联网操作的页面均标注 “离线可用” 标签。 |

### 10.2 各模块页面详情

#### 10.2.1 模块一：智能入库 (Intelligent Entry) 页面

表格

| 页面 ID |        页面名称         |                           核心布局                           |                           交互逻辑                           |                    适配规则                    | 优先级 |
| :-----: | :---------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :--------------------------------------------: | :----: |
|  P1.1   |       入库选择页        | 手机 / 平板：顶部标题栏 + 居中三大功能按钮（扫码入库 / 拍照入库 / 剪贴板解析）+ 底部 “产品字典快捷入口”；手表 / 智慧屏：无此页面 | 1. 点击 “扫码入库” 跳转至扫码页；2. 点击 “拍照入库” 跳转至相机页；3. 点击 “剪贴板解析” 触发文本解析，解析成功则展示待入库卡片，失败则弹窗提示；4. 点击产品字典入口跳转至 P4.1 页面 |   仅手机 / 平板展示，手表 / 智慧屏无入库能力   |   P0   |
|  P1.2   |       扫码入库页        | 手机 / 平板：全屏扫码取景框（顶部返回按钮 + 底部 “闪光灯 / 批量扫码” 开关）+ 扫码成功后自动弹出 P1.4 弹窗；手表 / 智慧屏：无此页面 | 1. 支持视频流连续扫码，批量扫码模式下自动识别多个条码并暂存；2. 扫码成功后震动反馈，自动触发条码匹配逻辑；3. 无条码识别时，底部展示 “手动录入条码” 按钮 |  仅手机 / 平板展示，适配前置 / 后置摄像头切换  |   P0   |
|  P1.3   |       拍照入库页        | 手机 / 平板：全屏相机取景框（顶部返回 + 底部 “抠图模式 / 普通模式” 切换 + 拍摄按钮）+ 右侧 “存储环境选择” 弹窗入口；手表 / 智慧屏：无此页面 | 1. 有 NPU 设备默认开启抠图模式，取景框实时展示 AI 抠图预览；2. 无 NPU 设备自动降级为普通模式，展示矩形裁剪框；3. 拍摄后自动识别食品属性，生成悬浮贴纸（食品名称 / 品类） |   仅手机 / 平板展示，适配不同分辨率相机预览    |   P0   |
|  P1.4   | 条码信息校验 / 录入弹窗 | 手机 / 平板：弹窗居中（标题 + 条码不可修改展示 + 商品名 / 品类 / 规格输入框 + 底部取消 / 确认按钮）；手表 / 智慧屏：无此弹窗 | 1. 匹配到信息时，输入框自动填充参考值，支持全选编辑；2. 商品名输入框标 “*”，为空时点击确认按钮给出红色提示；3. 点击确认后自动跳转至 P1.5 页面 |    仅手机 / 平板展示，输入框适配横竖屏切换     |   P0   |
|  P1.5   |    热量获取 / 校验页    | 手机 / 平板：顶部食品信息展示栏 + 居中 “拍营养表 / OCR 识别” 按钮 + 热量值输入框 + 底部 “确认入库” 按钮；手表 / 智慧屏：无此页面 | 1. 本地记忆有数据时，自动填充热量值并标注 “来自本地记忆”；2. 点击 “拍营养表” 触发 OCR 识别，识别后弹窗展示结果供修改；3. 热量值为 0 时，输入框高亮提示 “建议手动补录热量值” | 仅手机 / 平板展示，输入框支持数字键盘快捷输入  |   P0   |
|  P1.6   |      保质期确认页       | 手机 / 平板：食品信息卡片 + 存储环境选择栏（冷藏 / 冷冻 / 常温）+ 保质期预填值展示（可编辑）+ 确认按钮；手表 / 智慧屏：无此页面 | 1. 包装食品展示 “手动录入保质期” 输入框，生鲜食品展示 “自动计算结果（可修改）”；2. 选择存储环境后，实时更新保质期预填值；3. 确认后完成入库，返回库存页 | 仅手机 / 平板展示，适配不同食品类型的 UI 展示  |   P0   |
|  P1.7   |    剪贴板解析结果页     | 手机 / 平板：顶部返回 + 解析结果卡片列表（每条卡片含食品名称 / 置信度 +“加入入库” 按钮）+ 底部 “批量入库” 按钮；手表 / 智慧屏：无此页面 | 1. 置信度 <0.8 的卡片标注 “仅供参考”；2. 点击 “加入入库” 跳转至 P1.5 页面；3. 批量入库支持勾选多个卡片，统一进入热量校验流程 | 仅手机 / 平板展示，卡片数量 > 5 时支持上滑加载 |   P2   |

#### 10.2.2 模块二：沉浸式库存与实况 (Immersive Inventory) 页面

表格

| 页面 ID |      页面名称      |                           核心布局                           |                           交互逻辑                           |                           适配规则                           | 优先级 |
| :-----: | :----------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----: |
|  P2.1   | 库存首页（实物墙） | 手机 / 平板：顶部状态栏预警提示（临期 / 过期食品数量）+ 高性能瀑布流实物墙（食品贴纸 + 状态标签 + 保质期倒计时）+ 底部 “添加 / 筛选” 按钮；手表：圆形表盘展示 “正常 / 临期 / 过期” 数量 + 点击进入详情列表；智慧屏：大屏网格布局（每行 3 个食品卡片）+ 顶部筛选栏（按状态 / 品类） | 1. 手机 / 平板：长按食品卡片弹出操作面板（吃掉 / 扔掉 / 编辑），下拉刷新同步分布式数据，上滑加载更多；2. 手表：点击状态数字查看对应食品列表，仅展示名称 + 剩余保质期；3. 智慧屏：点击食品卡片查看详情，无操作按钮 | 手机 / 平板：适配瀑布流列数（手机 2 列 / 平板 3 列）；手表：适配圆形 / 方形表盘；智慧屏：卡片尺寸≥150dp |   P0   |
|  P2.2   |     锁屏实况窗     | 手机 / 平板：锁屏界面胶囊样式（左侧食品状态图标 + 右侧倒计时文字，渐变色随保质期加深）；手表 / 智慧屏：无此窗 | 1. 保质期 < 24 小时时自动展示，点击跳转至库存首页；2. 低电量 / 省电模式下自动隐藏；3. 支持用户在设置中关闭该功能 |           仅手机 / 平板锁屏展示，适配不同锁屏样式            |   P0   |
|  P2.3   |     食品详情页     | 手机 / 平板：顶部食品图片贴纸 + 居中食品信息（名称 / 规格 / 热量 / 存储环境）+ 底部操作按钮（吃掉 / 扔掉 / 编辑 / 删除）；手表：仅展示核心信息（名称 / 状态 / 剩余保质期）；智慧屏：大屏详情卡片 + 底部 “返回” 按钮 | 1. 手机 / 平板：点击 “编辑” 跳转至 P1.4/P1.5/P1.6 修改流程；2. 手表 / 智慧屏：仅查看，无操作按钮；3. 过期食品卡片置灰，“吃掉” 按钮禁用 |          全平台展示，手机 / 平板可操作，其他仅查看           |   P0   |

#### 10.2.3 模块三：无界消耗闭环 (Boundless Consumption) 页面

表格

| 页面 ID |     页面名称     |                           核心布局                           |                           交互逻辑                           |                   适配规则                    | 优先级 |
| :-----: | :--------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :-------------------------------------------: | :----: |
|  P3.1   |  家庭健康看板页  | 手机 / 平板：顶部家庭成员切换栏 + 热量摄入曲线图表 + 浪费分析图表 + 底部 “截图分享” 按钮；手表：圆形图表展示当日热量摄入 + 剩余额度；智慧屏：大屏分栏（左侧成员列表 + 右侧图表） | 1. 手机 / 平板：切换成员时实时刷新图表，支持缩放查看周 / 日数据；2. 手表：滑动切换 “今日 / 本周” 数据，仅展示数值 + 简易图表；3. 智慧屏：点击成员头像切换数据，图表支持大屏适配的动态渲染 | 全平台展示，手机 / 平板可截图分享，其他仅查看 |   P1   |
|  P3.2   | 跨设备拖拽交互层 | 手机 / 平板：拖拽时展示半透明食品卡片 + 目标成员头像高亮反馈；手表 / 智慧屏：无此交互层 | 1. 手机长按食品卡片触发拖拽模式，平板端成员头像区域高亮为可投放区；2. 拖拽过程中展示 “即将消耗 XX 食品” 提示；3. 传输中断时弹窗提示 “操作失败，库存已回滚” |    仅手机↔平板支持，适配鸿蒙软总线交互协议    |   P0   |
|  P3.3   | 食品消耗操作面板 | 手机 / 平板：弹窗样式（顶部食品名称 + 成员头像选择栏 + “吃掉 / 扔掉” 选项 + 备注输入框（扔掉时选填））；手表 / 智慧屏：无此面板 | 1. 选择 “吃掉” 后，需勾选家庭成员，确认后计入该成员热量流；2. 选择 “扔掉” 后，展示浪费原因选择框（过期 / 变质 / 其他），支持自定义备注；3. 操作完成后弹窗提示 “消耗成功”，并返回库存页 |    仅手机 / 平板展示，成员头像适配滑动选择    |   P0   |
|  P3.4   |  健康报表详情页  | 手机 / 平板：顶部时间筛选栏（日 / 周 / 月）+ 热量摄入曲线 + 浪费品类饼图 + 底部 “本地导出” 按钮；手表 / 智慧屏：仅展示简化报表（数值 + 简易图标） | 1. 支持长按图表查看具体数值，时间筛选实时刷新数据；2. 点击 “本地导出” 生成 JSON 文件，保存至设备本地存储；3. 报表数据永久保留，支持无限回溯 |         手机 / 平板可导出，其他仅查看         |   P1   |

#### 10.2.4 模块四：本地记忆管理页面

表格

| 页面 ID |     页面名称      |                           核心布局                           |                           交互逻辑                           |                       适配规则                       | 优先级 |
| :-----: | :---------------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :--------------------------------------------------: | :----: |
|  P4.1   |  产品字典管理页   | 手机 / 平板：顶部搜索栏 + 字典列表（每条含条码 / 名称 / 品类 / 热量 / 操作按钮）+ 底部 “导入 / 导出” 按钮；手表：列表仅展示名称 + 热量；智慧屏：大屏列表（每行含完整信息 + 操作按钮） | 1. 手机 / 平板：点击 “编辑” 跳转至 P1.4 弹窗修改信息，点击 “删除” 二次确认后移除数据；2. 搜索栏支持按名称 / 条码检索，支持模糊匹配；3. 导入 / 导出按钮触发本地文件选择器，仅支持 JSON 格式 | 全平台展示，手机 / 平板可编辑 / 导入导出，其他仅查看 |   P1   |
|  P4.2   |  OCR 记录查询页   | 手机 / 平板：顶部时间筛选栏 + 记录列表（每条含时间 / 食品名称 / AI 识别值 / 最终值 + “修改” 按钮）；手表 / 智慧屏：无此页面 | 1. 支持按时间（近 7/15/30 天）或食品名称筛选；2. 点击 “修改” 重新触发热量校验流程，更新后同步至相关食品数据；3. 记录仅保留 30 天，到期自动归档（本地存储不删除） |         仅手机 / 平板展示，列表支持下拉刷新          |   P2   |
|  P4.3   | 数据备份 / 恢复页 | 手机 / 平板：顶部标题 + “全量导出 / 全量导入 / 产品字典单独导出” 按钮 + 备份记录列表；手表 / 智慧屏：无此页面 | 1. 导出时弹窗提示 “备份文件已保存至 XX 路径”，导入时校验文件格式；2. 备份记录展示导出时间 + 文件大小，支持点击查看文件；3. 导入失败时提示 “文件格式错误，请选择正确的备份文件” |      仅手机 / 平板展示，适配不同存储路径的展示       |   P1   |

### 10.3 设备适配设计规范

表格

| 设备类型 |                         屏幕适配要求                         |                         交互适配要求                         |                         视觉适配要求                         |
| :------: | :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |
|   手机   | 适配 3.5~7.2 英寸屏幕，布局采用 “线性布局 + 弹性空间”，关键按钮（确认 / 入库）固定在底部；支持横竖屏切换 | 支持单点触控、长按拖拽，核心操作按钮尺寸≥48dp，间距≥16dp；弹窗支持点击空白处关闭 | 主色调 #007DFF（鸿蒙蓝），辅助色 #FF6B00（警示橙），文字色 #333333（正文）/#666666（辅助）；字体大小：标题 18sp，正文 16sp，辅助 14sp |
|   平板   | 适配 7.9~12.9 英寸屏幕，布局采用 “网格布局 + 分栏”，核心功能区居中，操作区靠下；支持分屏显示 | 支持多点触控、跨屏拖拽，按钮尺寸≥56dp，间距≥20dp；支持手写笔操作（如手动录入时的手写输入） | 视觉风格与手机一致，字体放大 1.2 倍；列表项高度≥60dp，适配大屏触控精度 |
|   手表   | 适配 1.2~1.8 英寸圆形 / 方形表盘，仅展示核心信息（状态 / 数值），布局采用 “环形 / 线性极简布局” | 仅支持点击、滑动操作，无长按 / 拖拽；操作反馈为震动 + 文字提示，无弹窗；单次展示信息≤3 条 | 主色调简化为 #007DFF，文字仅保留标题（14sp）+ 数值（16sp）；图标采用极简线性风格，尺寸≥24dp |
|  智慧屏  | 适配 43~98 英寸大屏，布局采用 “大卡片 + 少层级”，核心信息居中，操作按钮靠下；支持远距离操作 | 仅支持遥控器点击 / 滑动，按钮尺寸≥60dp，间距≥30dp；无弹窗，所有操作在当前页完成 | 视觉风格与手机一致，字体放大 1.5 倍；卡片阴影弱化，对比度提高；支持深色 / 浅色模式自动切换 |

### 10.4 交互视觉规范

#### 10.4.1 状态反馈设计

表格

|    交互状态     |                         视觉反馈要求                         |               设备适配补充                |
| :-------------: | :----------------------------------------------------------: | :---------------------------------------: |
|    操作成功     | 页面展示绿色对勾图标 + 简短文字提示（如 “入库成功”），持续 1.5 秒后自动消失；手机 / 平板增加轻微震动，手表增加短震动 | 智慧屏：提示文字放大，展示时长延长至 2 秒 |
| 操作失败 / 错误 | 页面展示橙色警告图标 + 引导性文字（如 “商品名不能为空，请填写”），输入框边框标红；手机 / 平板增加 1 次短震 |       手表：仅展示文字提示，无图标        |
|   数据加载中    | 页面展示鸿蒙原生加载动画（环形），居中显示；加载时长 > 3 秒时，展示 “正在本地处理，请稍候” 文字 |      智慧屏：加载动画放大，文字加粗       |
| 临期 / 过期预警 | 临期食品卡片边框为黄色，过期为红色；库存页顶部预警栏展示对应数量，文字渐变色（临期黄→过期红） |  手表：临期 / 过期状态用不同颜色图标区分  |

#### 10.4.2 动效设计规范

表格

|    动效场景     |                           动效要求                           |               性能约束               |
| :-------------: | :----------------------------------------------------------: | :----------------------------------: |
|    页面跳转     | 采用鸿蒙原生 “滑动入栈 / 出栈” 动效，时长 200ms；返回操作采用 “反向滑动” 动效 | 低配置设备可关闭动效，仅保留页面切换 |
| 弹窗展示 / 关闭 | 展示：从底部向上滑入（时长 150ms）；关闭：向下滑出（时长 150ms）；无弹窗叠加展示 |     手表端无弹窗动效，仅静态切换     |
|  食品卡片交互   | 长按卡片时轻微放大（1.05 倍）+ 阴影加深；拖拽时半透明（透明度 80%）+ 跟随手指移动 |    智慧屏端无拖拽动效，仅高亮反馈    |
|    图表渲染     | 健康报表图表采用 “渐进式渲染”，先展示骨架屏，再逐步渲染数据，动画时长 300ms |     手表端仅展示静态图表，无动效     |

#### 10.4.3 无障碍设计要求

1. **文字可读性**：所有文字满足 WCAG 2.1 对比度标准（正文对比度≥4.5:1，大文字≥3:1）；支持系统字体大小调整，页面布局自适应不重叠。
2. **屏幕朗读支持**：所有按钮、输入框、弹窗均添加无障碍标签（如 “扫码入库按钮，点击后进入扫码页面”），支持鸿蒙系统屏幕朗读功能。
3. **操作容错**：核心操作（如删除数据、清空字典）增加二次确认；误操作后支持撤销（如入库后 10 秒内可撤销）。
4. **色彩无障碍**：仅用颜色区分状态时，补充图标 / 文字提示（如过期食品除红色外，增加 “×” 图标）；支持系统深色 / 浅色模式适配。